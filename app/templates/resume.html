{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="resume">
        <div class="header">
            <h1>John Doe</h1>
            owner@email.com
            <img src="{{ url_for('static', filename='gorilla.png') }}" 
                alt="Gorilla" 
                class="profile-image">
        </div>
        <h2>Experience</h2>
        {% for exp in experiences %}
        <div>
            <h3>{{ exp.title }} at {{ exp.institution }}</h3>
            <p>{{ exp.start_date }} - {{ exp.end_date }}</p>
            <p>{{ exp.description }}</p>
        </div>
        {% endfor %}
        
        <h2>Skills</h2>
        <ul>
        {% for skill in skills %}
            <li>{{ skill.name }}</li>
        {% endfor %}
        </ul>
    </div>
    
<div class="chat">
    <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="message-input" 
                   placeholder="Type a message..." 
                   style="width: 80%; padding: 5px;"
                   onkeypress="if(event.key === 'Enter') sendMessage()">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<script>
    const socket = new WebSocket(`ws://${window.location.host}/ws/chat`);
    
    socket.onopen = function(event) {
        console.log("WebSocket connected");
    };
    
    socket.onmessage = function(event) {
        console.log("Received message:", event.data);
        const message = JSON.parse(event.data);
        addMessage(message.text);
    };
    
    socket.onerror = function(error) {
        console.error("WebSocket error:", error);
    };
    
    function sendMessage() {
        const input = document.getElementById('message-input');
        const text = input.value.trim();
        if (text) {
            console.log("Sending message:", text);
            socket.send(JSON.stringify({message: text}));
            input.value = '';
        }
    }
    
    function addMessage(text) {
        console.log("Adding message to DOM:", text);
        const messages = document.getElementById('chat-messages');
        const div = document.createElement('div');
        div.className = 'message';
        div.textContent = text;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    }
</script>

<style>
    .container {
        display: flex;
        height: calc(100vh - 60px); /* Account for header */
        overflow: hidden;
    }

    .chat {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #f5f5f5;
        border-left: 1px solid #ccc;
        min-width: 35%;
        height: 100%;
        position: relative;
    }

    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        background: white;
        margin: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
    }

    .chat-input {
        padding: 15px;
        background: #f5f5f5;
        border-top: 1px solid #ddd;
        display: flex;
        gap: 10px;
    }

    #message-input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    button {
        padding: 8px 15px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .message {
        margin: 8px 0;
        padding: 10px;
        background: #e3f2fd;
        border-radius: 5px;
        word-wrap: break-word;
    }

    .header {
        position: relative;
        margin-bottom: 2rem;
        min-height: 1.5in;
    }

    .profile-image {
        float: right;
        width: 1.5in;
        height: 1.5in;
        object-fit: cover;
        margin: 0 0 15px 15px;
        border-radius: 4px;
        shape-outside: margin-box;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
        margin: 0 0 0.5rem 0;
        color: #333;
    }

    .header p {
        color: #666;
        font-size: 1.1rem;
        margin: 0;
    }

    .resume {
        flex: 2;
        padding: 2rem;
        overflow-y: auto;
        max-width: 65%;
    }

</style>
{% endblock %}